<%@ page language="java" contentType="text/html; charset=utf-8"
    pageEncoding="utf-8"%>
<%@ page import="java.sql.*" %>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>나의 글 보기</title>
		<style>
			#wrap{
				width:700px;
				margin:0 auto;
				text-align:center;
			}
			#wrap:after{
				content: "";
				display:block;
				clear:both;
			}
			#btn1{
				width:120px;
				height:30px;
				font-size:20px;
				font-weight:600;
				text-align:center;
				line-height:30px;
				border:2px solid #450095;
				float:right;
				color:#450095;
				cursor:pointer;
			}
			#btn2{
				width:120px;
				height:30px;
				font-size:20px;
				font-weight:600;
				text-align:center;
				line-height:30px;
				border:2px solid #450095;
				float:right;
				color:navy;
				cursor:pointer;
			}
			#btn3{
				width:120px;
				height:30px;
				font-size:20px;
				font-weight:600;
				text-align:center;
				line-height:30px;
				border:2px solid #450095;
				float:right;
				color:navy;
				cursor:pointer;
			}
			#btn1:hover{
				background-color:#64c4DD; /*하늘색*/
				color:white;
			}
			#btn2:hover{
				background-color:#ffbf3f; /*노란색*/
				color:white;
			}
			#btn3:hover{
				background-color:#450095; /*남색*/
				color:white;
			}
			#logo{
            	margin: 20px auto;
                width: 150px;
                cursor: pointer;
            }
            .list{
            	width:600px;
            	height:60px;
            	font-size:20px;
            	fond-weight:bold;
            	color:navy;
            	padding:40px;
            	cursor:pointer;
            	float:left;
            	clear:both;
            }
            .list:hover{
            	color:#ffbf3f;
            }
            ul{
            	list-style:none;
            }
            a{
            	color: inherit;
            	cursor:pointer;
            	text-decoration:none;
            }
		</style>
	</head>
	<body>
		<div id="wrap">
			<%
				String author=(String)session.getAttribute("author");	
				System.out.println(author);
				
				String pg=request.getParameter("page");
				int currentPage=(pg!=null)?Integer.parseInt(pg):1;
				int recordsPerPage=5;
				int start=(currentPage-1)*recordsPerPage;
				
				Connection conn=null;
				Statement stmt=null;
				ResultSet rs=null;
			
				String url="jdbc:mysql://127.0.0.1:3306/fm_global";
				String db_id="root";
				String db_pw="iotiot";
				try{
					Class.forName("com.mysql.cj.jdbc.Driver");
					conn=DriverManager.getConnection(url, db_id, db_pw);
					
					String countSql="select count(*) from proposals where = "+author;
					stmt=conn.createStatement();
					rs=stmt.executeQuery(countSql);
					int totalRecords=0;
					if(rs.next()){
						totalRecords=rs.getInt(1);
					}
					rs.close();
					stmt.close();
					int totalPages=(int)Math.ceil((double)totalRecords/recordsPerPage);
					
					String sql="select p.num, p.title, m.fn, m.ln, m.location, p.created_at from proposals p join member m on p.author=m.num where p.author="+author;
					stmt=conn.createStatement();
					rs=stmt.executeQuery(sql);
					System.out.println(sql);
					while(rs.next()){
						int num=rs.getInt("num");
						String title=rs.getString("title");
						String firstName=rs.getString("fn");
						String lastName=rs.getString("ln");
						String location=rs.getString("location");
						String createdAt=rs.getString("created_at");
						%>
							<div class="list">
								<a href="progressmycreations.jsp?num=<%=num %>">
									<%=title %><br>
									<%=firstName+" "+lastName %><br>
									<%=location %><br>
									<%=createdAt %>
								</a>
								<!-- <form method="post" action="deleteprogress.jsp">
										<input type="hidden" value="<%=num %>" name="del">
										<input type="submit" value="삭제">
								</form> -->
							</div>
						<%
					}
				}catch(Exception e){
					System.out.println("접속 중 오류 발생" + e);
				}finally{
					try{
						if(rs!=null)rs.close();
						if(stmt!=null)stmt.close();
						if(conn!=null)conn.close();
					}catch(Exception ex){
						System.out.println("접속 해제 중 오류 발생"+ex);
					}
				}
			%>
		</div>
	</body>
</html>