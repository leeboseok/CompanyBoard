<%@ page language="java" contentType="text/html; charset=utf-8"
    pageEncoding="utf-8"%>
<%@ page import="java.sql.*" %>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>로그인 다음 페이지</title>
		<link rel="stylesheet" href="css/body.css">
	</head>
	<body>
		<%
			Connection conn=null;
			Statement stmt=null;
			ResultSet rs=null;
			
			String inputEmail=request.getParameter("userEmail");
			String inputPW=request.getParameter("userPassword");
			String inputFirstName=request.getParameter("FirstName");
			String adminID="admin@admin.com";
			
			String url="jdbc:mysql://127.0.0.1:3306/fm_global";
			String db_id="root";
			String db_pw="iotiot";
			try{
				Class.forName("com.mysql.cj.jdbc.Driver");
				conn=DriverManager.getConnection(url, db_id, db_pw);
				String sql="select * from member where email='"+inputEmail+"';";
				System.out.println(sql);
				stmt=conn.createStatement();
				rs=stmt.executeQuery(sql);
				System.out.println(rs.next());
				String pw=rs.getString("password");
				String email=rs.getString("email");
				String FirstName=rs.getString("FirstName");
				String Num=rs.getString("num");
				if(inputPW.equals(pw)){
					System.out.println(inputPW.equals(pw));
					session.setAttribute("Email", email);
					session.setAttribute("grade", "member");
					session.setAttribute("author", Num);
					response.sendRedirect("main.jsp?page=1");
					if(inputEmail.equals(adminID)){
						session.setAttribute("admin", "admin");
					}
				}else if(inputPW.equals(pw)==false){
					%>
						<script>
							alert("회원 확인, 비밀번호를 확인해주세요.");
							location.href="signin.jsp";
						</script>
					<%
				}
			}catch(Exception e){
				System.out.println("접속중 오류 발생"+e);
				%>
					<script>
						alert("회원확인 불가. 다시 로그인 해주세요.")
						location.href="login.jsp";
					</script>
				<%
			}finally{
				try{
					if(rs!=null)rs.close();
					if(stmt!=null)stmt.close();
					if(conn!=null)conn.close();
				}catch(Exception ex){
					System.out.println("접속 해제 중 오류 발생 : "+ex);
				}
			}
		%>
	</body>
</html>